---
title: "Coronavirus By County"
author: "Jim Gruman"
date: "2020-05-02" 
diagram: true
output: 
 blogdown::html_page:
  toc: true
categories: [R]
description: "COVID-19 Data Visualization Examples" 
# Featured image
# To use, add an image named `featured.jpg/png` to your page's folder.
# Focal points: Smart, Center, TopLeft, Top, TopRight, Left, Right, BottomLeft, Bottom, BottomRight.
image: 
  caption: ''
  focal_point: "Smart"
  preview_only: true
draft: false
featured: false
---

> Inspired by Kieran Healy's R package [`covdata`](https://kjhealy.github.io/covdata/)


```{r setup, echo=FALSE, message=FALSE, warning = FALSE}
knitr::opts_chunk$set(
	echo = FALSE,
	message = FALSE,
	warning = FALSE,
	include = TRUE
)
library(tidyverse)
library(lubridate)

update.packages("covdata")
library(covdata)          # By Kieran Healy https://kjhealy.github.io/covdata/

library(ggplot2)
library(gt)
library(plotly)

## Libraries for the graphs
library(ggrepel)
library(paletteer)
library(prismatic)

theme_set(theme_minimal())
```

The `covdata` package provides updated COVID-19 related data from the following sources:

- National level case and morality data from the European Centers for Disease Control

- State-level case and mortality data for the United States from the COVID Tracking Project

- State-level and county-level case and mortality data for the United States from the New York Times

- Data from the US Centers for Disease Control’s Coronavirus Disease 2019 (COVID-19)-Associated Hospitalization Surveillance Network (COVID-NET)

- Data from Apple on relative trends in mobility in cities and countries since mid-January of 2020, based on usage of their Maps application

- Data from Google on relative trends in mobility in regions and countries since mid-January of 2020, based on location and activity information

- Data from the CoronaNet Research Project, providing event-based tracking of governmental policy responses to the corona virus.

## Country-Level Data from ECDC

```{r}

end_date <- max(covnat$date)

covnat %>%
   as_tibble() %>%
   dplyr::filter( date == end_date)%>%
   select(Country = cname, `New Cases` = cases, `New Deaths` = deaths, `Cumulative Cases` = cu_cases, `Cumulative Deaths` = cu_deaths) %>%
   top_n(wt = `Cumulative Deaths`, n=10) %>%
   gt() %>%
   tab_header(
     title = "Country Level Data from ECDC (Sample)",
     subtitle = glue::glue("As of {end_date}")
   ) %>%
  fmt_number(
    columns = vars(`New Cases`, `New Deaths`, `Cumulative Cases`, `Cumulative Deaths`),
    decimals = 0,
    suffixing = TRUE
  ) 
  
```

### Cumulative reported cases by country

```{r CasesByCountry, fig.width=6}
## Convenince "Not in" operator
"%nin%" <- function(x, y) {
  return( !(x %in% y) )
}

## Countries to highlight
focus_cn <- c("CHN", "DEU", "GBR", "USA", "IRN", "JPN",
              "KOR", "ITA", "FRA", "ESP", "CHE", "TUR")

## Colors
cgroup_cols <- c(clr_darken(paletteer_d("ggsci::category20_d3"), 0.2)[1:length(focus_cn)], "gray70")

covnat %>%
  filter(cu_cases > 99) %>%
  mutate(days_elapsed = date - min(date),
        end_label = ifelse(date == max(date), cname, NA),
        end_label = recode(end_label, `United States` = "USA",
                            `Iran, Islamic Republic of` = "Iran",
                            `Korea, Republic of` = "South Korea",
                            `United Kingdom` = "UK"),
         cname = recode(cname, `United States` = "USA",
                        `Iran, Islamic Republic of` = "Iran",
                        `Korea, Republic of` = "South Korea",
                        `United Kingdom` = "UK"),
         end_label = case_when(iso3 %in% focus_cn ~ end_label,
                               TRUE ~ NA_character_),
         cgroup = case_when(iso3 %in% focus_cn ~ iso3,
                            TRUE ~ "ZZOTHER")) %>%
  ggplot(mapping = aes(x = days_elapsed, y = cu_cases,
         color = cgroup, label = end_label,
         group = cname)) +
  geom_line(size = 0.5) +
  geom_text_repel(nudge_x = 0.75,
                  segment.color = NA) +
  guides(color = FALSE) +
  scale_color_manual(values = cgroup_cols) +
  scale_y_continuous(labels = scales::comma_format(accuracy = 1),
                     breaks = 2^seq(4, 19, 1),
                     trans = "log2") +
  labs(x = "Days Since 100th Confirmed Case",
       y = "Cumulative Reported Cases (log2 scale)",
       title = "Cumulative Reported Cases of COVID-19, Selected Countries",
       subtitle = paste("ECDC data as of", format(max(covnat$date), "%A, %B %e, %Y")),
       caption = "Jim Gruman | Data: https://www.ecdc.europa.eu/") +
  theme(plot.title.position = "plot")

```

## State-Level Data from the COVID Tracking Project

```{r StateLevelCovidTracking, fig.width= 6}

end_date <- max(covus$date)

covus %>%
   as_tibble() %>%
   dplyr::filter( date == end_date, state == "IL")%>%
   select(-date, -state, -fips) %>%
   gt() %>%
   tab_header(
     title = "State Level Data from COVID Tracking Project",
     subtitle = glue::glue("Snapshot of Illinois As of {end_date}")
   ) 

```

### Cumulative reported US cases

```{r CumulativeUSCovidStates, fig.width=8}
## Which n states are leading the count of positive cases or deaths?
top_n_states <- function(data, n = 8, measure = c("positive", "death")) {
  meas <- match.arg(measure)
  data %>%
  group_by(state) %>%
  filter(measure == meas, date == max(date)) %>%
  drop_na() %>%
  ungroup() %>%
  top_n(n, wt = count) %>%
  pull(state)
}

state_cols <- c("gray70",
                prismatic::clr_darken(paletteer_d("ggsci::category20_d3"), 0.2))

covus %>%
  group_by(state) %>%
  mutate(core = case_when(state %nin% top_n_states(covus) ~ "",
                          TRUE ~ state),
         end_label = ifelse(date == max(date), core, NA)) %>%
  arrange(date) %>%
  filter(measure == "positive", date > "2020-03-09", 
         !state %in% c("GU","MP","VI")) %>%
  ggplot(aes(x = date, y = count, group = state, color = core, label = end_label)) +
  geom_line(size = 0.5) +
  geom_text_repel(segment.color = NA, nudge_x = 0.2, nudge_y = 0.1) +
  scale_color_manual(values = state_cols) +
  scale_x_date(date_breaks = "3 days", date_labels = "%b %e" ) +
  scale_y_continuous(trans = "log2",
                     labels = scales::comma_format(accuracy = 1),
                     breaks = 2^c(seq(1, 17, 1))) +
  guides(color = FALSE) +
  coord_equal() +
  labs(title = "COVID-19 Cumulative Recorded Cases by US State",
       subtitle = paste("Data as of", format(max(covus$date), "%A, %B %e, %Y")),
       x = "Date", y = "Count of Cases (log 2 scale)",
       caption = "@jim_gruman | Data: COVID Tracking Project, http://covidtracking.com")+
  theme(plot.title.position = "plot")

```

## State-Level and County-Level (Cumulative) Data from the *New York Times*

```{r NYTdatasets}
data("nytcovstate")
end_date <- max(nytcovstate$date)

nytcovstate %>%
  as_tibble()%>%
  head() %>%
  gt() %>%
   tab_header(
     title = "State Level Data from New York Times",
     subtitle = glue::glue("Sample Snapshot of NYT State Data Available As of {end_date}")
   ) 

data("nytcovcounty")
end_date <- max(nytcovcounty$date)

nytcovcounty %>%
    as_tibble()%>%
    head()%>%
    gt() %>%
   tab_header(
     title = "County Level Data from New York Times",
     subtitle = glue::glue("Sample Snapshot of NYT County Data Available As of {end_date}")
   ) 

```

### Cumulative US cases, all counties

```{r CumulativeUSEveryStatebyCounty, fig.height= 18 }
nytcovcounty %>%
  mutate(uniq_name = paste(county, state)) %>% # Can't use FIPS because of how the NYT bundled cities
  group_by(uniq_name) %>%
  mutate(days_elapsed = date - min(date)) %>%
  ggplot(aes(x = days_elapsed, y = cases, group = uniq_name)) +
  geom_line(size = 0.25, color = "gray20") +
  scale_y_log10(labels = scales::label_number_si()) +
  guides(color = FALSE) +
  facet_wrap(~ state, ncol = 5) +
  labs(title = "COVID-19 Cumulative Recorded Cases by US County",
       subtitle = paste("New York is bundled into a single area in this data.\nData as of", format(max(nytcovcounty$date), "%A, %B %e, %Y")),
       x = "Days since first case", y = "Count of Cases (log 10 scale)",
       caption = "@jim_gruman | Data: The New York Times")+
  theme(plot.title.position = "plot")
```

### Illinois Counties

```{r IllinoisCasesByCounty}
## Counties to highlight
focus_ct <- c("Cook", "DuPage", "Lake", "Will", "Kane")

## Colors
cgroup_cols <- c(clr_darken(paletteer_d("ggsci::category20_d3"), 0.2)[1:length(focus_cn)], "gray70")

nytcovcounty %>%
  filter(state == "Illinois") %>%
  group_by(county) %>%
  mutate(core = case_when(county %nin% focus_ct ~ "",
                          TRUE ~ county),
         end_label = ifelse(date == max(date), core, NA), 
         days_elapsed = date - min(date)) %>% 
  ggplot(aes(x = days_elapsed, y = cases, group = county, color = core, label = end_label)) +
  geom_line(size = 0.25) +
  geom_text_repel(nudge_x = 0.75,
                  segment.color = NA) +
  guides(color = FALSE) +
  scale_color_manual(values = cgroup_cols) +
  scale_y_log10(labels = scales::label_number_si()) +
  guides(color = FALSE) +
  labs(title = "Illinois COVID-19 Cumulative Recorded Cases by County",
       subtitle = paste("Data as of", format(max(nytcovcounty$date), "%A, %B %e, %Y")),
       x = "Days since first case", y = "Count of Cases (log 10 scale)",
       caption = "@jim_gruman | Data: The New York Times")+
  theme(plot.title.position = "plot")
```

```{r IllinoisCasesByCountyNew}
## Counties to highlight
focus_ct <- c("Cook", "DuPage", "Lake", "Will", "Kane")

## Colors
cgroup_cols <- c(clr_darken(paletteer_d("ggsci::category20_d3"), 0.2)[1:length(focus_cn)], "gray70")

## Timespan
lims <- c(lubridate::today()-45, lubridate::today())

nytcovcounty %>%
  filter(state == "Illinois", county %in% focus_ct) %>%
  group_by(county) %>%
  mutate(core = case_when(county %nin% focus_ct ~ "",
                          TRUE ~ county),
         end_label = ifelse(date == max(date), core, NA), 
         days_elapsed = date - min(date),
         NewCases = cases - lag(cases)) %>% 
  filter(!is.na(NewCases), NewCases != 0) %>%
  ggplot(aes(x = date, y = NewCases, group = county, color = core, label = end_label)) +
  geom_point(size = 2, shape =1) +
  geom_smooth(size = 0.5, se = FALSE , method = "loess")+
  geom_text_repel(nudge_x = 0.75,
                  segment.color = NA) +
  guides(color = FALSE) +
  scale_color_manual(values = cgroup_cols) +
  scale_y_log10(labels = scales::label_number_auto(),
                limits = c(1,1500)) +
  scale_x_date(breaks = "week", labels = scales::date_format("%B-%d"),
               limits = lims)+
  guides(color = FALSE) +
  labs(title = "Illinois COVID-19 Daily New Recorded Cases by County",
       subtitle = paste("Data as of", format(max(nytcovcounty$date), "%A, %B %e, %Y")),
       x = "Date", y = "New Cases",
       caption = "@jim_gruman | Data: The New York Times")+
  theme(plot.title.position = "plot")
```

```{r IllinoisDeathsByCounty}
## Counties to highlight
focus_ct <- c("Cook", "DuPage", "Lake", "Will", "Kane")

## Colors
cgroup_cols <- c(clr_darken(paletteer_d("ggsci::category20_d3"), 0.2)[1:length(focus_cn)], "gray70")

nytcovcounty %>%
  filter(state == "Illinois") %>%
  group_by(county) %>%
  mutate(core = case_when(county %nin% focus_ct ~ "",
                          TRUE ~ county),
         end_label = ifelse(date == max(date), core, NA), 
         days_elapsed = date - min(date)) %>% 
  ggplot(aes(x = days_elapsed, y = deaths, group = county, color = core, label = end_label)) +
  geom_line(size = 0.25) +
  geom_text_repel(nudge_x = 0.75,
                  segment.color = NA) +
  guides(color = FALSE) +
  scale_color_manual(values = cgroup_cols) +
  scale_y_log10(labels = scales::label_number_si()) +
  guides(color = FALSE) +
  labs(title = "Illinois COVID-19 Cumulative Recorded Deaths by County",
       subtitle = paste("Data as of", format(max(nytcovcounty$date), "%A, %B %e, %Y")),
       x = "Days since first case", y = "Count of Deaths (log 10 scale)",
       caption = "@jim_gruman | Data: The New York Times")+
  theme(plot.title.position = "plot")
```

### Iowa Counties

```{r IowaCasesByCounty}
## Counties to highlight
focus_ct <- c("Johnson", "Dallas", "Linn", "Polk", "Scott", "Tama", "Washington")

## Colors
cgroup_cols <- c(clr_darken(paletteer_d("ggsci::category20_d3"), 0.2)[1:length(focus_cn)], "gray70")

nytcovcounty %>%
  filter(state == "Iowa") %>%
  group_by(county) %>%
  mutate(core = case_when(county %nin% focus_ct ~ "",
                          TRUE ~ county),
         end_label = ifelse(date == max(date), core, NA), 
         days_elapsed = date - min(date)) %>%
  ggplot(aes(x = days_elapsed, y = cases, group = county, color = core, label = end_label)) +
  geom_line(size = 0.25) +
  geom_text_repel(nudge_x = 0.75,
                  segment.color = NA) +
  guides(color = FALSE) +
  scale_color_manual(values = cgroup_cols) +
  scale_y_log10(labels = scales::label_number_si()) +
  guides(color = FALSE) +
  labs(title = "Iowa COVID-19 Cumulative Recorded Cases by County",
       subtitle = paste("Data as of", format(max(nytcovcounty$date), "%A, %B %e, %Y")),
       x = "Days since first case", y = "Count of Cases (log 10 scale)",
       caption = "@jim_gruman | Data: The New York Times")+
  theme(plot.title.position = "plot")
```

```{r IowaCasesByCountyNew}
## Counties to highlight
focus_ct <- c("Johnson", "Dallas", "Linn", "Polk", "Scott", "Tama", "Washington", "Muscatine","Scott", "Louisa", "Marshall", "Jasper","Woodbury", "Black Hawk")

## Colors
cgroup_cols <- c(clr_darken(paletteer_d("ggsci::category20_d3"), 0.2)[1:length(focus_cn)], "gray70")

## Timespan
lims <- c(lubridate::today()-45, lubridate::today())

nytcovcounty %>%
  filter(state == "Iowa", county %in% focus_ct) %>%
  group_by(county) %>%
  mutate(core = case_when(county %nin% focus_ct ~ "",
                          TRUE ~ county),
         end_label = ifelse(date == max(date), core, NA), 
         days_elapsed = date - min(date),
         NewCases = cases - lag(cases)) %>% 
  filter(!is.na(NewCases), NewCases != 0) %>%
  ggplot(aes(x = date, y = NewCases, group = county, color = core, label = end_label)) +
  geom_point(size = 2, shape =1) +
  geom_smooth(size = 0.5, se = FALSE , method = "loess")+
  geom_text_repel(nudge_x = 0.75,
                  segment.color = NA) +
  guides(color = FALSE) +
  scale_color_manual(values = cgroup_cols) +
  scale_y_log10(labels = scales::label_number_auto(),
                limits = c(1,100)) +
  scale_x_date(breaks = "week", labels = scales::date_format("%B-%d"),
               limits = lims)+
  guides(color = FALSE) +
  labs(title = "Iowa COVID-19 New Daily Recorded Cases by County",
       subtitle = paste("Data as of", format(max(nytcovcounty$date), "%A, %B %e, %Y")),
       x = "Date", y = "New Cases (log 10 scale)",
       caption = "@jim_gruman | Data: The New York Times")+
  theme(plot.title.position = "plot")
```

```{r IowaDeathsByCounty}
## Counties to highlight
focus_ct <- c("Johnson", "Dallas", "Linn", "Polk", "Scott", "Tama", "Washington")

## Colors
cgroup_cols <- c(clr_darken(paletteer_d("ggsci::category20_d3"), 0.2)[1:length(focus_cn)], "gray70")

nytcovcounty %>%
  filter(state == "Iowa") %>%
  group_by(county) %>%
  mutate(core = case_when(county %nin% focus_ct ~ "",
                          TRUE ~ county),
         end_label = ifelse(date == max(date), core, NA), 
         days_elapsed = date - min(date)) %>%
  ggplot(aes(x = days_elapsed, y = deaths, group = county, color = core, label = end_label)) +
  geom_line(size = 0.25) +
  geom_text_repel(nudge_x = 0.75,
                  segment.color = NA) +
  guides(color = FALSE) +
  scale_color_manual(values = cgroup_cols) +
  scale_y_log10(labels = scales::label_number_si()) +
  guides(color = FALSE) +
  labs(title = "Iowa COVID-19 Cumulative Recorded Deaths by County",
       subtitle = paste("Data as of", format(max(nytcovcounty$date), "%A, %B %e, %Y")),
       x = "Days since first case", y = "Count of Deaths (log 10 scale)",
       caption = "@jim_gruman | Data: The New York Times")+
  theme(plot.title.position = "plot")
```

### South Dakota Counties

```{r SDCasesByCounty}
## Counties to highlight
focus_ct <- c("Minnehaha", "Lincoln", "Beadle", "Yankton")

## Colors
cgroup_cols <- c(clr_darken(paletteer_d("ggsci::category20_d3"), 0.2)[1:length(focus_cn)], "gray70")

nytcovcounty %>%
  filter(state == "South Dakota") %>%
  group_by(county) %>%
  mutate(core = case_when(county %nin% focus_ct ~ "",
                          TRUE ~ county),
         end_label = ifelse(date == max(date), core, NA), 
         days_elapsed = date - min(date)) %>% 
  ggplot(aes(x = days_elapsed, y = cases, group = county, color = core, label = end_label)) +
  geom_line(size = 0.25) +
  geom_text_repel(nudge_x = 0.75,
                  segment.color = NA) +
  guides(color = FALSE) +
  scale_color_manual(values = cgroup_cols) +
  scale_y_log10(labels = scales::label_number_si()) +
  guides(color = FALSE) +
  labs(title = "South Dakota COVID-19 Cumulative Recorded Cases by County",
       subtitle = paste("Data as of", format(max(nytcovcounty$date), "%A, %B %e, %Y")),
       x = "Days since first case", y = "Count of Cases (log 10 scale)",
       caption = "@jim_gruman | Data: The New York Times")+
  theme(plot.title.position = "plot")
```

```{r SDDeathsByCounty}
## Counties to highlight

nytcovcounty %>%
  filter(state == "South Dakota") %>%
  group_by(county) %>%
  mutate(core = case_when(county %nin% focus_ct ~ "",
                          TRUE ~ county),
         end_label = ifelse(date == max(date), core, NA), 
         days_elapsed = date - min(date)) %>%
  ggplot(aes(x = days_elapsed, y = deaths, group = county, color = core, label = end_label)) +
  geom_line(size = 0.25) +
  geom_text_repel(nudge_x = 0.75,
                  segment.color = NA) +
  guides(color = FALSE) +
  scale_color_manual(values = cgroup_cols) +
  scale_y_log10(labels = scales::label_number_si()) +
  guides(color = FALSE) +
  labs(title = "South Dakota COVID-19 Cumulative Recorded Deaths by County",
       subtitle = paste("Data as of", format(max(nytcovcounty$date), "%A, %B %e, %Y")),
       x = "Days since first case", y = "Count of Deaths (log 10 scale)",
       caption = "@jim_gruman | Data: The New York Times")+
  theme(plot.title.position = "plot")
```

## US CDC Surveillance Network Data

This US Centers for Disase Control surveillance network conducts population-based surveillance for laboratory-confirmed COVID-19-associated hospitalizations in children (persons younger than 18 years) and adults in the United States. The current network covers nearly 100 counties in the 10 Emerging Infections Program (EIP) states (CA, CO, CT, GA, MD, MN, NM, NY, OR, and TN) and four additional states through the Influenza Hospitalization Surveillance Project (IA, MI, OH, and UT). The network represents approximately 10% of US population (~32 million people). Cases are identified by reviewing hospital, laboratory, and admission databases and infection control logs for patients hospitalized with a documented positive SARS-CoV-2 test. Data gathered are used to estimate age-specific hospitalization rates on a weekly basis and describe characteristics of persons hospitalized with COVID-19. Laboratory confirmation is dependent on clinician-ordered SARS-CoV-2 testing. Therefore, the unadjusted rates provided are likely to be underestimated as COVID-19-associated hospitalizations can be missed due to test availability and provider or facility testing practices. COVID-NET hospitalization data are preliminary and subject to change as more data become available. All incidence rates are unadjusted. Please use the following citation when referencing these data: “COVID-NET: COVID-19-Associated Hospitalization Surveillance Network, Centers for Disease Control and Prevention. WEBSITE. Accessed on DATE”.

```{r CDCSurveillanceAgeDemographics, fig.height=7}
# install.packages("cdccovidview", repos = c("https://cinc.rud.is", "https://cloud.r-project.org/"))

age_f <- c(
  "0-4 yr", "5-17 yr", "18-49 yr",
  "50-64 yr", "65+ yr", "65-74 yr",
  "75-84 yr", "85+")

cdc_hospitalizations %>%
  mutate(start = cdccovidview::mmwr_week_to_date(mmwr_year, mmwr_week)) %>%
  filter(!is.na(weekly_rate)) %>%
  filter(catchment == "Entire Network") %>%
  select(start, network, age_category, weekly_rate) %>%
  filter(age_category != "Overall") %>%
  mutate(age_category = factor(age_category, levels = age_f)) %>%
  ggplot() +
  geom_line(aes(start, weekly_rate)) +
  scale_x_date(
    date_breaks = "2 weeks", date_labels = "%b\n%d"
  ) +
  facet_grid(network ~ age_category) +
  labs(x = NULL, y = "Rates per 100,000 pop",
    title = "COVID-NET Weekly Hospitalization Rates by Network and Age Group",
    subtitle = "Courtesy Bob Rudis's cdccovidview",
    caption = sprintf("Source: COVID-NET: COVID-19-Associated Hospitalization Surveillance Network, Centers for Disease Control and Prevention.\n<https://gis.cdc.gov/grasp/COVIDNet/COVID19_3.html>; Accessed on %s", Sys.Date())) +
  theme(plot.title.position = "plot")
```

## Apple Mobility Data

Apple has made aggregated data available on relative trends in use of its Maps data across a range of cities, regions, and countries. Data show relative volume of directions requests per country/region or city compared to a baseline volume on January 13th, 2020. Apple defines the day as midnight-to-midnight, Pacific time. Cities represent usage in greater metropolitan areas and are stably defined during this period. In many countries/regions and cities, relative volume has increased since January 13th, consistent with normal, seasonal usage of Apple Maps. Day of week effects are important to normalize as you use this data. Data that is sent from users’ devices to the Apple Maps service is associated with random, rotating identifiers so Apple does not have a profile of individual movements and searches. Apple Maps has no demographic information about its users, and so cannot make any statements about the representativeness of its usage against the overall population.

```{r apple, fig.height=18}
data("apple_mobility")

vec_brks <- c(-50, 0, 50)
vec_labs <- vec_brks + 100

apple_mobility %>%
  filter(geo_type == "city", transportation_type == "driving") %>%
  mutate(over_under = index < 100,
         index = index - 100) %>%
  ggplot(mapping = aes(x = date, y = index,
                       group = region, color = over_under)) +
  geom_hline(yintercept = 100, color = "gray40") +
  geom_col() +
  scale_y_continuous(breaks = vec_brks, labels = vec_labs )+
  scale_color_manual(values = c("firebrick", "steelblue")) +
  facet_wrap(~ region, ncol = 8) +
  guides(color = FALSE) +
  labs(x = "Date", y = "Relative Mobility", title = "Relative Trends in Apple Maps Usage for Driving, Selected Cities",
                              subtitle = "Apple Data. Indexed to 100 for each city's usage on January 13th 2020",
       caption = paste("@jim_gruman, Data as of", format(max(nytcovcounty$date), "%A, %B %e, %Y"))) +
  theme_minimal()
```

```{r, echo = FALSE} 
blogdown::shortcode("tweet", "1254085357714448385")
```

## Google Mobility Reports

These Community Mobility Reports aim to provide insights into what has changed in response to policies aimed at combating COVID-19. The reports chart movement trends over time by geography, across different categories of places such as retail and recreation, groceries and pharmacies, parks, transit stations, workplaces, and residential. Each Community Mobility Report dataset is presented by location and highlights the percent change in visits to places like grocery stores and parks within a geographic area. These datasets show how visits and length of stay at different places change compared to a baseline. Changes for each day are compared to a baseline value for that day of the week:

- The baseline is the median value, for the corresponding day of the week, during the 5-week period Jan 3–Feb 6, 2020.

- The datasets show trends over several months.

- What data is included in the calculation depends on user settings, connectivity, and whether it meets Google’s privacy threshold. 

If the privacy threshold isn’t met (when somewhere isn’t busy enough to ensure anonymity) no change is shown for the day.


```{r Google, fig.height=11}
data("google_mobility")

Google<-google_mobility %>%
  filter(country_region_code == "US", !is.na(sub_region_1), is.na(sub_region_2)) %>%
  mutate(type = tools::toTitleCase(type),
         state = sub_region_1) %>%
  ggplot(mapping = aes(x = date, y = pct_diff,
                       group = state)) +
  geom_line(aes(text = state),size = 0.5, color = "gray80") +
  geom_smooth(aes(color = type, group = 1), se = FALSE) +
  facet_wrap(~ type, ncol = 2) +
  labs(x = "Date", y = "Percent Change from Baseline", title = "Relative Trends in Mobility for Kinds of Location in the US, by State",
                              subtitle = "Google Data. All are relative to median activity between Jan 3rd and Feb 6th",
       color = "Location Type",
       caption = paste("@jim_gruman")) +
  theme_minimal() +
  theme(legend.position = "top",
        strip.text = element_text(size = rel(1.3)))

ggplotly(Google, tooltip = c("state","pct_diff"))
```


Citations: 

Kieran Healy. 2020. covdata: COVID-19 Case and Mortality Time Series. R package version 0.1.0,
<http://kjhealy.github.io/covdata>.




