---
title: "rtweet"
author: "Jim Gruman"
date: "2020-05-27"
diagram: true
output: 
 blogdown::html_page:
  toc: false
categories: [R]
description: "Analyze Twitter data" 
image: 
  caption: ''
  focal_point: "Smart"
  preview_only: true
featured: false
draft: false
---



<p>I was inspired by David Robinsonâ€™s Tidy Tuesday screencast to work with <code>rtweet</code> on some familiar Twitter handles and ended up discovering a bug and a workaround for windows users.</p>
<p><code>rtweet</code> is an amazing way of having a little productive procrastination while honing R skills</p>
{{% youtube "KE9ItC3doEU" %}}
<p>As with any other project, loading the appropriate libraries.</p>
<pre class="r"><code>library(tidyverse)   # tidy data manipulation, including dplyr and ggplot
library(rtweet)      # the R Twitter API
theme_set(hrbrthemes::theme_ft_rc())   # Set a ggplot color, font theme
library(showtext)   
library(lubridate)   # date manipulation tools
showtext_auto()</code></pre>
<p>The <code>rtweet</code> <a href="http://rtweet.info/articles/auth.html">Obtaining and using access tokens</a> vignette gives instructions for creating tokens and writing them to <code>.Renviron</code>, one-time only, as:</p>
<pre class="r"><code>token &lt;- create_token(
  app = &quot;mytwitterapp_NDMSBA&quot;,
  consumer_key = api_key,
  consumer_secret = api_secret_key,
  access_token = access_token,
  access_secret = access_token_secret)</code></pre>
<p>Unfortunately, the process currently works properly in Linux environments, but not in Windows. Closely inspect the token created:</p>
<pre class="r"><code> token&lt;-rtweet::get_token()

 token</code></pre>
<p>You have found the bug when the token returned does not match the keys created previously.</p>
<p>The solution to the problem is to edit your local <code>.Renviron</code> file manually. In the console, type</p>
<pre class="r"><code>usethis::edit_r_environ()</code></pre>
<p>Find the <strong>TWITTER_PAT</strong> parameter and change every back slash <code>\</code> and forward slash <code>/</code> to double backslashes <code>\\</code> to the rds file address. It will resemble</p>
<p><code>"C:\\Users\\&lt;youruser&gt;\\Documents\\.rtweet_token.rds"</code></p>
<p>Save the <code>.Renviron</code> file. Then Restart R (Ctrl+Shift+F10). Closely inspect the token again:</p>
<pre class="r"><code>token&lt;-rtweet::get_token()

token</code></pre>
<p>It turns out that <a href="https://github.com/ropensci/rtweet/issues/380">Jon Harmon has also reported of the issue at the package Github repository.</a>.</p>
<hr />
<p>Letâ€™s have a look at the accounts that I favorite (or <strong>like</strong>) the most:</p>
<pre class="r"><code># there is a rate limit at Twitter at approximately 18000 each 15 minutes
df_likes &lt;- rtweet::get_favorites(&quot;jim_gruman&quot;, n = 3000)</code></pre>
<pre class="r"><code>users_favorite&lt;-df_likes %&gt;% 
    group_by(screen_name, user_id) %&gt;%
    summarise(
        quant_fav= n()
    )

users_favorite %&gt;%
    ungroup() %&gt;%
    top_n(15,quant_fav) %&gt;%
    mutate(screen_name = reorder(screen_name,quant_fav)) %&gt;%
    ggplot(aes(y = screen_name, x = quant_fav, fill = quant_fav)) + 
    geom_col(show.legend = FALSE) +
    theme(plot.title.position = &quot;plot&quot;,
          text = element_text(hrbrthemes::font_rc, size = 16))+
    labs(
        title = &quot;Top 15 Twitter accounts I like the most often&quot;,
        subtitle = paste0(&quot;Within the past 3000 Tweets, since &quot;,min(as_date(df_likes$created_at,  tz =&quot;America/Chicago&quot;))),
        y = &quot;@ user names&quot;,
        x= &quot;# of tweets liked&quot;,
        caption = paste0(&quot;@jim_gruman | &quot;, Sys.Date())
    )</code></pre>
<p><img src="/post/rtweet-on-windows/index_files/figure-html/unnamed-chunk-8-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>And letâ€™s break down my activity by week day</p>
<pre class="r"><code>tw_activity&lt;- df_likes %&gt;% 
    transmute(
              tw_hour = hour(as_datetime(created_at, tz =&quot;America/Chicago&quot;)),
              tw_day = as_date(created_at, tz =&quot;America/Chicago&quot;),
              tw_weekday = wday(tw_day,label = T, abbr = T, week_start = 1)
    ) %&gt;%
    group_by(tw_weekday, tw_hour) %&gt;%
    summarise(
        quant_fav= n()
    ) %&gt;% 
    ungroup() %&gt;% 
    group_by(tw_weekday) %&gt;% 
    mutate(prop = quant_fav / sum(quant_fav)) %&gt;% 
    ungroup()
  
tw_activity %&gt;%
    ggplot(aes(x = tw_hour, y = prop, fill = prop)) + 
    geom_col(position = position_nudge(x = .5),
             show.legend = FALSE) +
    scale_x_continuous(breaks = c(6, 12, 18))+
    hrbrthemes::scale_y_percent()+
    facet_wrap(~tw_weekday, ncol = 5)+
    theme(text = element_text(hrbrthemes::font_rc, size = 16),
    panel.grid.minor = element_blank(),
    plot.title.position = &quot;plot&quot;,
    plot.margin = margin(0.25,0.5,0.25,0.5,&quot;in&quot;)
      )+
    labs(
        title = &quot;My recent liking activity on Twitter&quot;,
        subtitle = paste0(&quot;Within the past 3000 Tweets, since &quot;,min(as.Date(df_likes$created_at, tz = &quot;America/Chicago&quot;))),
        x = &quot;hour of the day&quot;,
        y = &quot;&quot;,
        caption = paste0(&quot;@jim_gruman | &quot;, Sys.Date())
    )</code></pre>
<p><img src="/post/rtweet-on-windows/index_files/figure-html/unnamed-chunk-9-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Some may prefer the <code>ggridges</code> version of the same data visualization</p>
<pre class="r"><code>library(ggridges)

tw_activity %&gt;%
  mutate(tw_weekday = fct_rev(tw_weekday))%&gt;%
ggplot(aes(x = tw_hour, , y = tw_weekday, height = prop, fill = stat(x)))+
ggridges::geom_ridgeline_gradient(scale = 10, show.legend = FALSE)+
  scale_fill_gradient2(low = &quot;blue&quot;,
                        mid = &quot;grey50&quot;,
                        high = &quot;blue&quot;,
                        midpoint = 12L)+
    theme(text = element_text(hrbrthemes::font_rc, size = 16),
    panel.grid.minor = element_blank(),
    plot.title.position = &quot;plot&quot;,
    plot.margin = margin(0.25,0.5,0.25,0.5,&quot;in&quot;)
      )+
    labs(
        title = &quot;My recent liking activity on Twitter&quot;,
        subtitle = paste0(&quot;Within the past 3000 Tweets, since &quot;,min(as.Date(df_likes$created_at, tz = &quot;America/Chicago&quot;))),
        x = &quot;hour of the day&quot;,
        y = &quot;Proportion of Tweet Likes&quot;,
        caption = paste0(&quot;@jim_gruman | &quot;, Sys.Date())
    )</code></pre>
<p><img src="/post/rtweet-on-windows/index_files/figure-html/unnamed-chunk-10-1.png" width="672" style="display: block; margin: auto;" /></p>
<hr />
<div id="did-you-find-this-page-helpful-consider-sharing-it" class="section level3">
<h3>Did you find this page helpful? Consider sharing it ðŸ™Œ</h3>
</div>
