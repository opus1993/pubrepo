---
title: "rtweet"
author: "Jim Gruman"
date: "`r Sys.Date()`"
diagram: true
output: 
 blogdown::html_page:
  toc: false
categories: [R]
description: "Analyze Twitter data" 
image: 
  caption: ''
  focal_point: "Smart"
  preview_only: true
featured: false
draft: false
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,
                      message = FALSE)
```

I was inspired by David Robinson's Tidy Tuesday screencast to work with `rtweet` on some familiar Twitter handles and ended up discovering a bug and a workaround for windows users. 

{`rtweet`} is an amazing way of having a little productive procrastination while demostrating R skills

```{r echo=FALSE}
blogdown::shortcode('youtube', 'KE9ItC3doEU')
```

As with any other project, loading the appropriate libraries.

```{r}
library(tidyverse)   # tidy data manipulation, including dplyr and ggplot
library(rtweet)      # the R Twitter API
theme_set(hrbrthemes::theme_ft_rc())   # Set a ggplot color, font theme
library(showtext)   
library(lubridate)   # date manipulation tools
showtext_auto()
```

The `rtweet` [Obtaining and using access tokens](http://rtweet.info/articles/auth.html) vignette gives instructions for creating tokens and writing them to `.Renviron`, one-time only, as:

```{r eval=FALSE}
token <- create_token(
  app = "mytwitterapp_NDMSBA",
  consumer_key = api_key,
  consumer_secret = api_secret_key,
  access_token = access_token,
  access_secret = access_token_secret)
```
Unfortunately, the process currently works properly in Linux environments, but not in Windows. Closely inspect the token created:

```{r eval=FALSE}
 token<-rtweet::get_token()

 token
```

You have found the bug when the token returned does not match the keys created previously.

The solution to the problem is to edit your local `.Renviron` file manually. In the console, type

```{r eval=FALSE}
usethis::edit_r_environ()
```

Find the **TWITTER_PAT** parameter and change every back slash `\` and forward slash `/` to double backslashes `\\` to the rds file address.  It will resemble

`"C:\\Users\\<youruser>\\Documents\\.rtweet_token.rds"`

Save the `.Renviron` file.  Then Restart R (Ctrl+Shift+F10). Closely inspect the token again:

```{r eval=FALSE}
token<-rtweet::get_token()

token
```
It turns out that [Jon Harmon has also reported of the issue at the package Github repository.](https://github.com/ropensci/rtweet/issues/380). 

----

Let's have a look at the accounts that I favorite (or **like**) the most:

```{r warning=FALSE, fig.align='center'}
# there is a rate limit at Twitter at approximately 18000 each 15 minutes
df_likes <- rtweet::get_favorites("jim_gruman", n = 3000)

users_favorite<-df_likes %>% 
    group_by(screen_name, user_id) %>%
    summarise(
        quant_fav= n()
    )

start <- as.Date(min(df_likes$created_at), tz = "America/Chicago")
end <- as.Date(max(df_likes$created_at), tz = "America/Chicago")

users_favorite %>%
    ungroup() %>%
    top_n(15,quant_fav) %>%
    mutate(screen_name = reorder(screen_name,quant_fav)) %>%
    ggplot(aes(y = screen_name, x = quant_fav, fill = quant_fav)) + 
    geom_col(show.legend = FALSE) +
    theme(plot.title.position = "plot",
          text = element_text(hrbrthemes::font_rc, size = 16))+
    labs(
        title = "Top 15 Twitter accounts I like the most often",
        subtitle = paste0("Within the past 3000 Tweets, ",start, " to ",end),
        y = "@ user names",
        x= "# of tweets liked",
        caption = paste0("@jim_gruman | ", Sys.Date())
    )

ggsave("my-twitter-likes-users.png", width = 7, height = 5, type = "cairo")
```

And let's break down my activity by week day

```{r warning=FALSE, fig.align='center', fig.width=7, fig.height=5}
df_likes %>% 
    transmute(
        created_at,
        hour = created_at %>% hour(),
        year = created_at %>% year(), 
        month = created_at %>% month(label = T), 
        weekday = created_at %>% wday(label = T, abbr = T, week_start = 1)
    ) %>%
    group_by(weekday, hour) %>%
    summarise(
        quant_fav= n()
    ) %>% 
    ungroup() %>% 
    group_by(weekday) %>% 
    mutate(prop = quant_fav / sum(quant_fav)) %>% 
    ungroup() %>%
    ggplot(aes(x = hour, y = prop, fill = prop)) + 
    geom_col(position = position_nudge(x = .5),
             show.legend = FALSE) +
    scale_x_continuous(breaks = c(6, 12, 18))+
    hrbrthemes::scale_y_percent()+
    facet_wrap(~weekday, ncol = 5)+
    theme(text = element_text(hrbrthemes::font_rc, size = 16),
    panel.grid.minor = element_blank(),
    plot.title.position = "plot",
    plot.margin = margin(0.25,0.5,0.25,0.5,"in")
      )+
    labs(
        title = "My recent liking activity on Twitter",
        subtitle = paste0("Within the past 3000 Tweets, ",start, " to ",end),
        x = "hour of the day",
        y = "",
        caption = paste0("@jim_gruman | ", Sys.Date())
    )

ggsave("my-twitter-likes-by-hour-weekday.png", width = 7, height = 5, type = "cairo")

```

----

### Did you find this page helpful? Consider sharing it ðŸ™Œ

